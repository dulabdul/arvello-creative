---
// src/components/section/Faq.astro
import { sanityClient } from '@/lib/sanity';
import FaqAccordion, { type FaqItem } from '../ui/FAQAccordion'; // Pastikan nama file import sesuai
import spiralImage from '@/assets/decoration-faq.png';
import { Image } from 'astro:assets';

export interface Props {
  lang: 'id' | 'en';
}
const { lang } = Astro.props;

// --- Data Fetching ---
let sectionData: any = null;

try {
  sectionData = await sanityClient.fetch(`*[_type == "faqSection"][0]`);
} catch (error) {
  console.error('Sanity FAQ Fetch Error:', error);
}

// --- Localize Static Text & Process FAQs ---
const headline =
  sectionData?.headline?.[lang] ||
  (lang === 'id'
    ? 'Pertanyaan yang Sering Diajukan'
    : 'Frequently Asked Questions');

const rawFaqs = sectionData?.faqs || [];

const processedFaqs: FaqItem[] = rawFaqs.map((faq: any, index: number) => ({
  _key: faq._key || String(index),
  question: faq.question?.[lang] || 'Untitled Question',
  answer: faq.answer?.[lang]?.replace(/\n/g, '\n') || 'No answer provided.',
}));
---

<section
  id='faq'
  class='py-20 md:py-32 bg-slate-50 relative overflow-hidden'>
  {/* --- BACKGROUND DECORATION 100% FIX --- */}
  {
    /* Gambar dipindah ke luar "container" agar bisa menempel persis di ujung kiri layar (left-0) */
  }
  {/* Ini akan menyembunyikan sisi potongan rata bawaan dari file PNG-nya */}
  <div
    class='absolute top-20 lg:top-32 left-0 w-[75%] sm:w-[50%] lg:w-[40%] max-w-[600px] pointer-events-none z-0 opacity-40 md:opacity-60'>
    <Image
      src={spiralImage}
      alt='FAQ Decoration'
      class='w-full h-auto object-contain object-left'
    />
  </div>

  <div class='container mx-auto px-4 max-w-7xl relative z-10'>
    <div class='grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-16 items-start'>
      {/* --- KOLOM KIRI (Headline) --- */}
      <div
        class='lg:col-span-5 flex flex-col justify-center relative lg:sticky lg:top-32 min-h-[150px] lg:min-h-[400px]'>
        {/* Teks Headline di atas background */}
        <h2
          class='text-5xl md:text-6xl lg:text-7xl font-extrabold text-slate-900 tracking-tight leading-[1.1] relative z-10'>
          {
            headline
              .split(' ')
              .map((word: string) => <span class='block'>{word}</span>)
          }
        </h2>
      </div>

      {/* --- KOLOM KANAN (Accordion React Island) --- */}
      <div class='lg:col-span-7 relative z-10 pt-8 lg:pt-0'>
        {
          processedFaqs.length > 0 ? (
            <FaqAccordion
              client:visible
              faqs={processedFaqs}
            />
          ) : (
            <div class='p-12 border-2 border-dashed border-slate-300 rounded-[2rem] text-center text-slate-500 bg-white'>
              {lang === 'id'
                ? 'Belum ada pertanyaan FAQ yang diisi di CMS.'
                : 'No FAQ items available.'}
            </div>
          )
        }
      </div>
    </div>
  </div>
</section>
